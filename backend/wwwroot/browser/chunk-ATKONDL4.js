import{A as u,Ca as c,Ga as g,d as a,l as s,o as l,r as n}from"./chunk-6GEMUR5H.js";var h=class o{constructor(e,t){this.http=e;this.router=t}apiUrl="http://localhost:5000/api/auth";tokenKey="auth_token";userKey="auth_user";currentUserSubject=new a(this.getUserFromStorage());currentUser$=this.currentUserSubject.asObservable();isAuthenticated=u(this.hasToken());login(e,t){return this.http.post(`${this.apiUrl}/login`,{username:e,password:t}).pipe(s({next:r=>{r.success&&r.token&&this.setSession(r.token,r.user)},error:r=>{console.error("Error en login:",r),this.clearSession()}}))}register(e,t,r,p){return this.http.post(`${this.apiUrl}/register`,{username:e,password:t,email:r,nombre:p}).pipe(s({next:i=>{i.success&&i.token&&this.setSession(i.token,i.user)},error:i=>{console.error("Error en registro:",i)}}))}logout(){this.getToken()&&this.http.post(`${this.apiUrl}/logout`,{}).subscribe({error:t=>console.error("Error en logout:",t)}),this.clearSession(),this.router.navigate(["/login"])}verifyToken(){return this.http.get(`${this.apiUrl}/verify`).pipe(s({next:e=>{e.valid&&e.user&&(this.currentUserSubject.next(e.user),this.isAuthenticated.set(!0))},error:()=>{this.clearSession()}}))}setSession(e,t){localStorage.setItem(this.tokenKey,e),localStorage.setItem(this.userKey,JSON.stringify(t)),this.currentUserSubject.next(t),this.isAuthenticated.set(!0)}clearSession(){localStorage.removeItem(this.tokenKey),localStorage.removeItem(this.userKey),this.currentUserSubject.next(null),this.isAuthenticated.set(!1)}getToken(){return localStorage.getItem(this.tokenKey)}getCurrentUser(){return this.currentUserSubject.value}getUserFromStorage(){let e=localStorage.getItem(this.userKey);return e?JSON.parse(e):null}hasToken(){return!!localStorage.getItem(this.tokenKey)}static \u0275fac=function(t){return new(t||o)(n(c),n(g))};static \u0275prov=l({token:o,factory:o.\u0275fac,providedIn:"root"})};export{h as a};
