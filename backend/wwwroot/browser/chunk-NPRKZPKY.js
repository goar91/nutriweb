import{a as Y,b as $}from"./chunk-XBIBXTRY.js";import{b as z,d as G,e as V,g as I,h as B,i as j,j as H,n as R,p as L}from"./chunk-A2N6GWGJ.js";import{$ as w,A as p,Aa as A,F as c,Ga as T,I as h,J as F,N as g,Q as y,R as C,S as _,X as d,Y as n,Z as i,_ as o,a as E,aa as v,b as M,ba as m,ea as a,fa as u,ga as D,j as S,k as P,t as O,u as N,v as f,w as b,wa as k,xa as q}from"./chunk-6GEMUR5H.js";function W(s,t){s&1&&(n(0,"div",3),f(),n(1,"svg",20),o(2,"path",25),i(),b(),n(3,"span"),a(4,"Modo Edici\xF3n - Modificando datos existentes"),i()())}function J(s,t){s&1&&(n(0,"section",17)(1,"div",26),f(),n(2,"svg",27),o(3,"path",28),i(),b(),n(4,"div")(5,"h3"),a(6,"Editando datos personales"),i(),n(7,"p"),a(8,'Solo puedes modificar los datos personales del paciente. Para editar una historia cl\xEDnica completa, usa el bot\xF3n "Editar" en la historia cl\xEDnica espec\xEDfica desde el dashboard.'),i()()()())}function Z(s,t){if(s&1&&(n(0,"th"),a(1),i()),s&2){let e=t.$implicit;c(),u(e)}}function X(s,t){if(s&1){let e=w();n(0,"td")(1,"label",101)(2,"input",102),v("change",function(){let r=O(e).$implicit,x=m().$implicit,U=m().$implicit,Q=m(2);return N(Q.setFrequency(U.title,x,r))}),i(),n(3,"span",103),a(4),i()()()}if(s&2){let e=t.$implicit,l=m().$implicit,r=m().$implicit,x=m(2);c(2),d("value",e)("checked",x.getFrequency(r.title,l)===e),y("name",x.frequencyKey(r.title,l)),c(2),u(e)}}function ee(s,t){if(s&1&&(n(0,"tr")(1,"td"),a(2),i(),g(3,X,5,4,"td",100),i()),s&2){let e=t.$implicit,l=m(3);c(2),u(e),c(),d("ngForOf",l.supportedFrequencies)}}function te(s,t){if(s&1&&(n(0,"div",97)(1,"div",98)(2,"h3"),a(3),i(),n(4,"p"),a(5,"Selecciona la frecuencia que mejor describe el consumo habitual."),i()(),n(6,"div",99)(7,"table")(8,"thead")(9,"tr")(10,"th"),a(11,"Alimento"),i(),g(12,Z,2,1,"th",100),i()(),n(13,"tbody"),g(14,ee,4,2,"tr",100),i()()()()),s&2){let e=t.$implicit,l=m(2);y("data-title",e.title),c(3),u(e.title),c(9),d("ngForOf",l.supportedFrequencies),c(2),d("ngForOf",e.items)}}function ie(s,t){if(s&1&&(n(0,"section",5)(1,"h2"),a(2,"Motivo de consulta"),i(),n(3,"label",29),o(4,"textarea",30),i()(),n(5,"section",5)(6,"h2"),a(7,"Antecedentes"),i(),n(8,"div",31)(9,"label"),a(10," APF "),o(11,"input",32),i(),n(12,"label"),a(13," APP "),o(14,"input",33),i(),n(15,"label"),a(16," APQ "),o(17,"input",34),i(),n(18,"label"),a(19," AGO "),o(20,"input",35),i(),n(21,"label"),a(22," Menarqu\xEDa "),o(23,"input",36),i(),n(24,"label"),a(25," P \xB7 G \xB7 C \xB7 A "),o(26,"input",37)(27,"input",38)(28,"input",39)(29,"input",40),i(),n(30,"label"),a(31," Alergias "),o(32,"input",41),i()()(),n(33,"section",5)(34,"h2"),a(35,"Diagn\xF3stico nutricional cl\xEDnico"),i(),n(36,"label",29),o(37,"textarea",42),i()(),n(38,"section",5)(39,"h2"),a(40,"H\xE1bitos del paciente"),i(),n(41,"div",43)(42,"label"),a(43," Fuma "),o(44,"input",44),i(),n(45,"label"),a(46," Alcohol "),o(47,"input",45),i(),n(48,"label"),a(49," Caf\xE9 "),o(50,"input",46),i(),n(51,"label"),a(52," Hidrataci\xF3n "),o(53,"input",47),i(),n(54,"label"),a(55," Gaseosas "),o(56,"input",48),i(),n(57,"label"),a(58," Actividad f\xEDsica "),o(59,"input",49),i(),n(60,"label"),a(61," T\xE9 "),o(62,"input",50),i(),n(63,"label"),a(64," Uso de edulcorantes "),o(65,"input",51),i(),n(66,"label"),a(67," Alimentaci\xF3n "),o(68,"input",52),i()()(),n(69,"section",5)(70,"h2"),a(71,"Signos vitales"),i(),n(72,"div",53)(73,"label"),a(74," PA "),o(75,"input",54),i(),n(76,"label"),a(77," Temperatura "),o(78,"input",55),i(),n(79,"label"),a(80," FC "),o(81,"input",56),i(),n(82,"label"),a(83," FR "),o(84,"input",57),i()()(),n(85,"section",5)(86,"h2"),a(87,"Datos antropom\xE9tricos"),i(),n(88,"div",58)(89,"label"),a(90," Edad "),o(91,"input",59),i(),n(92,"label"),a(93," Edad metab\xF3lica "),o(94,"input",60),i(),n(95,"label"),a(96," Sexo "),o(97,"input",61),i(),n(98,"label"),a(99," Peso "),o(100,"input",62),i(),n(101,"label"),a(102," Masa muscular "),o(103,"input",63),i(),n(104,"label"),a(105," % GC "),o(106,"input",64),i(),n(107,"label"),a(108," GC "),o(109,"input",65),i(),n(110,"label"),a(111," Talla "),o(112,"input",66),i(),n(113,"label"),a(114," % GV "),o(115,"input",67),i(),n(116,"label"),a(117," IMC "),o(118,"input",68),i(),n(119,"label"),a(120," KCAL basales "),o(121,"input",69),i(),n(122,"label"),a(123," Cinta de actividad f\xEDsica "),o(124,"input",49),i(),n(125,"label"),a(126," Cintura "),o(127,"input",70),i(),n(128,"label"),a(129," Cadera "),o(130,"input",71),i(),n(131,"label"),a(132," Pantorrilla "),o(133,"input",72),i(),n(134,"label"),a(135," C. brazo "),o(136,"input",73),i(),n(137,"label"),a(138," C. muslo "),o(139,"input",74),i(),n(140,"label"),a(141," Peso ajustado "),o(142,"input",75),i(),n(143,"label"),a(144," Factor de actividad f\xEDsica "),o(145,"input",76),i(),n(146,"label"),a(147," Tiempos de comida "),o(148,"input",77),i()()(),n(149,"section",5)(150,"h2"),a(151,"Valores bioqu\xEDmicos"),i(),n(152,"div",78)(153,"label"),a(154," Glicemia "),o(155,"input",79),i(),n(156,"label"),a(157," Colesterol total "),o(158,"input",80),i(),n(159,"label"),a(160," Triglic\xE9ridos "),o(161,"input",81),i(),n(162,"label"),a(163," HDL "),o(164,"input",82),i(),n(165,"label"),a(166," LDL "),o(167,"input",83),i(),n(168,"label"),a(169," TGO "),o(170,"input",84),i(),n(171,"label"),a(172," TGP "),o(173,"input",85),i(),n(174,"label"),a(175," Urea "),o(176,"input",86),i(),n(177,"label"),a(178," Creatinina "),o(179,"input",87),i()()(),n(180,"section",5)(181,"h2"),a(182,"Frecuencia de consumo de alimentos"),i(),g(183,te,15,4,"div",88),i(),n(184,"section",5)(185,"h2"),a(186,"Recordatorio de 24 h"),i(),n(187,"div",89)(188,"label"),a(189," Desayuno "),o(190,"textarea",90),i(),n(191,"label"),a(192," Snack "),o(193,"textarea",91),i(),n(194,"label"),a(195," Almuerzo "),o(196,"textarea",92),i(),n(197,"label"),a(198," Snack "),o(199,"textarea",93),i(),n(200,"label"),a(201," Cena / merienda "),o(202,"textarea",94),i(),n(203,"label"),a(204," Extras "),o(205,"textarea",95),i()()(),n(206,"section",5)(207,"h2"),a(208,"Notas extras"),i(),n(209,"label",29),o(210,"textarea",96),i()()),s&2){let e=m();c(183),d("ngForOf",e.foodCategories)}}function ne(s,t){if(s&1&&(n(0,"p",104),a(1),i()),s&2){let e=m();c(),u(e.resultMessage())}}var K=class s{constructor(t,e,l,r){this.fb=t;this.nutritionService=e;this.editDataService=l;this.router=r;this.nutriForm=this.buildForm()}pageTitle=p("NutriWeb \xB7 Historia cl\xEDnica nutricional");supportedFrequencies=["Nunca","1\u20133/mes","1/sem","2\u20134/sem","5\u20136/sem","1/d\xEDa","\u22652/d\xEDa"];foodCategories=[{title:"1. Cereales y tub\xE9rculos",items:["Arroz","Pan","Avena","Yuca","Papa","Fideos / pasta","Quinua"]},{title:"2. Verduras",items:["Hojas verdes","Br\xF3coli","Tomate","Zanahoria","Pepino"]},{title:"3. Frutas",items:["Manzana","Banano","C\xEDtricos","Fresas","Papaya"]},{title:"4. Prote\xEDnas animales",items:["Pollo","Carne de res","Pescado","Huevo","Cerdo"]},{title:"5. Prote\xEDnas vegetales",items:["Legumbres","Tofu / soya","Frutos secos"]},{title:"6. L\xE1cteos",items:["Leche","Yogur","Queso"]},{title:"7. Grasas",items:["Aguacate","Aceite vegetal","Mantequilla"]},{title:"8. Bebidas",items:["Agua","Jugos azucarados","Gaseosas","Caf\xE9","T\xE9 / infusiones"]},{title:"9. Ultraprocesados",items:["Snacks","Galletas","Pasteles / dulces","Comida r\xE1pida"]}];nutriForm;resultMessage=p(null);isSubmitting=p(!1);isEditingPatient=p(!0);isEditMode=p(!1);editingId=p(null);editType=p(null);frequencySelections={};cedulaSubscription;buildForm(){return this.fb.group({personalData:this.fb.group({nombre:[""],edadCronologica:[""],sexo:[""],lugarResidencia:[""],estadoCivil:[""],numeroCedula:[""],telefono:[""],ocupacion:[""],email:[""],fechaConsulta:[""]}),motivoConsulta:[""],antecedentes:this.fb.group({apf:[""],app:[""],apq:[""],ago:[""],menarquia:[""],p:[""],g:[""],c:[""],a:[""],alergias:[""]}),diagnostico:[""],habitos:this.fb.group({fuma:[""],alcohol:[""],cafe:[""],hidratacion:[""],gaseosas:[""],actividadFisica:[""],te:[""],edulcorantes:[""],alimentacion:[""]}),signos:this.fb.group({pa:[""],temperatura:[""],fc:[""],fr:[""]}),antropometricos:this.fb.group({edad:[""],edadMetabolica:[""],sexo:[""],peso:[""],masaMuscular:[""],gcPorc:[""],gc:[""],talla:[""],gvPorc:[""],imc:[""],kcalBasales:[""],actividadFisica:[""],cintura:[""],cadera:[""],pantorrilla:[""],cBrazo:[""],cMuslo:[""],pesoAjustado:[""],factorActividadFisica:[""],tiemposComida:[""]}),valoresBioquimicos:this.fb.group({glicemia:[""],colesterolTotal:[""],trigliceridos:[""],hdl:[""],ldl:[""],tgo:[""],tgp:[""],urea:[""],creatinina:[""]}),recordatorio24h:this.fb.group({desayuno:[""],snack1:[""],almuerzo:[""],snack2:[""],cena:[""],extras:[""]}),notasExtras:[""]})}ngOnInit(){console.log("====== APP COMPONENT ngOnInit ======");let t=this.editDataService.getEditContext();console.log("Edit context on init:",t),t?this.loadDataForEdit(t):console.log("No edit context found"),this.setupCedulaAutocomplete()}ngOnDestroy(){this.cedulaSubscription&&this.cedulaSubscription.unsubscribe()}setupCedulaAutocomplete(){let t=this.nutriForm.get("personalData.numeroCedula");t&&(this.cedulaSubscription=t.valueChanges.pipe(S(500),P()).subscribe(e=>{e&&e.trim().length>=6&&!this.isEditMode()&&this.buscarYAutocompletarPorCedula(e.trim())}))}buscarYAutocompletarPorCedula(t){this.nutritionService.buscarPacienteConUltimaHistoria(t).subscribe({next:e=>{console.log("Paciente encontrado con c\xE9dula:",t,e);let l=this.nutriForm.get("personalData");if(l&&e.paciente&&l.patchValue({nombre:e.paciente.nombre||"",edadCronologica:e.paciente.edad_cronologica||"",sexo:e.paciente.sexo||"",lugarResidencia:e.paciente.lugar_residencia||"",estadoCivil:e.paciente.estado_civil||"",telefono:e.paciente.telefono||"",ocupacion:e.paciente.ocupacion||"",email:e.paciente.email||""}),e.ultima_historia){if(e.ultima_historia.antecedentes){let r=e.ultima_historia.antecedentes;this.nutriForm.patchValue({antecedentes:{apf:r.apf||"",app:r.app||"",apq:r.apq||"",ago:r.ago||"",menarquia:r.menarquia||"",p:r.p||"",g:r.g||"",c:r.c||"",a:r.a||"",alergias:r.alergias||""}})}if(e.ultima_historia.habitos){let r=e.ultima_historia.habitos;this.nutriForm.patchValue({habitos:{fuma:r.fuma||"",alcohol:r.alcohol||"",cafe:r.cafe||"",hidratacion:r.hidratacion||"",gaseosas:r.gaseosas||"",actividadFisica:r.actividad_fisica||"",te:r.te||"",edulcorantes:r.edulcorantes||"",alimentacion:r.alimentacion||""}})}if(e.ultima_historia.valores_bioquimicos){let r=e.ultima_historia.valores_bioquimicos;this.nutriForm.patchValue({valoresBioquimicos:{glicemia:r.glicemia||"",colesterolTotal:r.colesterol_total||"",trigliceridos:r.trigliceridos||"",hdl:r.hdl||"",ldl:r.ldl||"",tgo:r.tgo||"",tgp:r.tgp||"",urea:r.urea||"",creatinina:r.creatinina||""}})}if(e.ultima_historia.recordatorio_24h){let r=e.ultima_historia.recordatorio_24h;this.nutriForm.patchValue({recordatorio24h:{desayuno:r.desayuno||"",snack1:r.snack1||"",almuerzo:r.almuerzo||"",snack2:r.snack2||"",cena:r.cena||"",extras:r.extras||""}})}this.resultMessage.set("\u2713 Datos del paciente y su \xFAltima historia cl\xEDnica cargados autom\xE1ticamente"),setTimeout(()=>this.resultMessage.set(null),4e3)}else this.resultMessage.set("\u2713 Datos del paciente cargados autom\xE1ticamente"),setTimeout(()=>this.resultMessage.set(null),3e3)},error:e=>{e.status!==404&&console.error("Error buscando paciente por c\xE9dula:",e)}})}loadDataForEdit(t){console.log("loadDataForEdit - editContext:",t),console.log("editContext.type:",t.type),console.log("editContext.data:",t.data),t.type==="historia"&&t.data?(this.isEditMode.set(!0),this.editingId.set(t.id),this.editType.set("historia"),this.pageTitle.set("Editar Historia Cl\xEDnica"),console.log("Cargando historia cl\xEDnica - editType set to:",this.editType()),this.loadHistoriaData(t.data)):t.type==="paciente"?(this.isEditMode.set(!0),this.editingId.set(t.id),this.editType.set("paciente"),this.pageTitle.set("Editar Datos del Paciente"),console.log("Cargando paciente - editType set to:",this.editType()),this.nutritionService.getPaciente(t.id).subscribe({next:e=>{this.loadPacienteData(e)},error:e=>{console.error("Error cargando paciente:",e),this.resultMessage.set("Error al cargar los datos del paciente")}})):console.warn("No se pudo determinar el tipo de edici\xF3n o faltan datos"),this.editDataService.clearEditContext()}loadHistoriaData(t){if(console.log("Cargando historia con datos:",t),t.personal_data&&this.nutriForm.patchValue({personalData:{nombre:t.personal_data.nombre||"",edadCronologica:t.personal_data.edad_cronologica||"",sexo:t.personal_data.sexo||"",lugarResidencia:t.personal_data.lugar_residencia||"",estadoCivil:t.personal_data.estado_civil||"",numeroCedula:t.personal_data.numero_cedula||"",telefono:t.personal_data.telefono||"",ocupacion:t.personal_data.ocupacion||"",email:t.personal_data.email||"",fechaConsulta:t.fecha_consulta||""}}),this.nutriForm.patchValue({motivoConsulta:t.motivo_consulta||"",diagnostico:t.diagnostico||""}),t.datos_antropometricos){let e=t.datos_antropometricos;this.nutriForm.patchValue({antropometricos:{peso:e.peso||"",talla:e.talla||"",imc:e.imc||"",cintura:e.circunferencia_cintura||"",cadera:e.circunferencia_cadera||"",cBrazo:e.circunferencia_brazo||"",cMuslo:e.circunferencia_muslo||"",pantorrilla:e.circunferencia_pantorrilla||"",masaMuscular:e.masa_muscular||"",gcPorc:e.grasa_corporal_porcentaje||"",gc:e.grasa_corporal||"",gvPorc:e.grasa_visceral_porcentaje||"",edad:e.edad||"",sexo:e.sexo||"",edadMetabolica:e.edad_metabolica||"",kcalBasales:e.kcal_basales||"",actividadFisica:e.actividad_fisica||"",pesoAjustado:e.peso_ajustado||"",factorActividadFisica:e.factor_actividad_fisica||"",tiemposComida:e.tiempos_comida||""}})}if(t.signos_vitales){let e=t.signos_vitales;this.nutriForm.patchValue({signos:{pa:e.presion_arterial||"",fc:e.frecuencia_cardiaca||"",fr:e.frecuencia_respiratoria||"",temperatura:e.temperatura||""}})}if(t.antecedentes){let e=t.antecedentes;this.nutriForm.patchValue({antecedentes:{apf:e.apf||"",app:e.app||"",apq:e.apq||"",ago:e.ago||"",menarquia:e.menarquia||"",p:e.p||"",g:e.g||"",c:e.c||"",a:e.a||"",alergias:e.alergias||""}})}if(t.habitos){let e=t.habitos;this.nutriForm.patchValue({habitos:{fuma:e.fuma||"",alcohol:e.alcohol||"",cafe:e.cafe||"",hidratacion:e.hidratacion||"",gaseosas:e.gaseosas||"",actividadFisica:e.actividad_fisica||"",te:e.te||"",edulcorantes:e.edulcorantes||"",alimentacion:e.alimentacion||""}})}if(t.valores_bioquimicos){let e=t.valores_bioquimicos;this.nutriForm.patchValue({valoresBioquimicos:{glicemia:e.glicemia||"",colesterolTotal:e.colesterol_total||"",trigliceridos:e.trigliceridos||"",hdl:e.hdl||"",ldl:e.ldl||"",tgo:e.tgo||"",tgp:e.tgp||"",urea:e.urea||"",creatinina:e.creatinina||""}})}if(t.recordatorio_24h){let e=t.recordatorio_24h;this.nutriForm.patchValue({recordatorio24h:{desayuno:e.desayuno||"",snack1:e.snack1||"",almuerzo:e.almuerzo||"",snack2:e.snack2||"",cena:e.cena||"",extras:e.extras||""}})}t.frecuencia_consumo&&Array.isArray(t.frecuencia_consumo)&&(this.frequencySelections={},t.frecuencia_consumo.forEach(e=>{let l=this.frequencyKey(e.categoria,e.alimento);this.frequencySelections[l]=e.frecuencia})),this.nutriForm.patchValue({notasExtras:t.notas_extras||""}),console.log("Formulario despu\xE9s de cargar datos:",this.nutriForm.value),this.isEditingPatient.set(!1)}loadPacienteData(t){this.nutriForm.patchValue({personalData:{nombre:t.nombre||"",edadCronologica:t.edad_cronologica||"",sexo:t.sexo||"",lugarResidencia:t.lugar_residencia||"",estadoCivil:t.estado_civil||"",numeroCedula:t.numero_cedula||"",telefono:t.telefono||"",ocupacion:t.ocupacion||"",email:t.email||"",fechaConsulta:""}}),this.isEditingPatient.set(!1)}submitHistory(){this.nutriForm.invalid&&this.nutriForm.markAllAsTouched(),this.isSubmitting.set(!0);let t=this.nutriForm.value,e={personalData:t.personalData,motivoConsulta:t.motivoConsulta,diagnostico:t.diagnostico,notasExtras:t.notasExtras,antecedentes:t.antecedentes,habitos:t.habitos,signosVitales:t.signos?{presionArterial:t.signos.pa,temperatura:t.signos.temperatura,frecuenciaCardiaca:t.signos.fc,frecuenciaRespiratoria:t.signos.fr}:null,datosAntropometricos:t.antropometricos?{edad:t.antropometricos.edad,edadMetabolica:t.antropometricos.edadMetabolica,sexo:t.antropometricos.sexo,peso:t.antropometricos.peso,masaMuscular:t.antropometricos.masaMuscular,grasaCorporalPorcentaje:t.antropometricos.gcPorc,grasaCorporal:t.antropometricos.gc,talla:t.antropometricos.talla,grasaVisceralPorcentaje:t.antropometricos.gvPorc,imc:t.antropometricos.imc,kcalBasales:t.antropometricos.kcalBasales,actividadFisica:t.antropometricos.actividadFisica,circunferenciaCintura:t.antropometricos.cintura,circunferenciaCadera:t.antropometricos.cadera,pantorrilla:t.antropometricos.pantorrilla,circunferenciaBrazo:t.antropometricos.cBrazo,circunferenciaMuslo:t.antropometricos.cMuslo,pesoAjustado:t.antropometricos.pesoAjustado,factorActividadFisica:t.antropometricos.factorActividadFisica,tiemposComida:t.antropometricos.tiemposComida}:null,valoresBioquimicos:t.valoresBioquimicos,recordatorio24h:t.recordatorio24h,frequency:this.frequencySelections};if(this.isEditMode()&&this.editingId())if(this.editType()==="paciente"){let l={numeroCedula:e.personalData.numeroCedula,nombre:e.personalData.nombre,edadCronologica:e.personalData.edadCronologica,sexo:e.personalData.sexo,email:e.personalData.email,telefono:e.personalData.telefono,lugarResidencia:e.personalData.lugarResidencia,estadoCivil:e.personalData.estadoCivil,ocupacion:e.personalData.ocupacion};this.nutritionService.updatePaciente(this.editingId(),l).subscribe({next:()=>{this.resultMessage.set("Datos del paciente actualizados correctamente."),this.isSubmitting.set(!1),this.resetForm(),this.router.navigate(["/dashboard"])},error:r=>{console.error(r),this.resultMessage.set("No se pudo actualizar el paciente. Error: "+(r.error?.error||r.message)),this.isSubmitting.set(!1)}})}else console.log("Actualizando historia ID:",this.editingId()),console.log("Payload a enviar:",e),this.nutritionService.updateHistoriaClinica(this.editingId(),e).subscribe({next:()=>{this.resultMessage.set("Historia cl\xEDnica guardada correctamente."),this.isSubmitting.set(!1),this.resetForm(),this.router.navigate(["/dashboard"])},error:l=>{console.error("Error completo:",l),console.error("Error status:",l.status),console.error("Error response:",l.error);let r="No se pudo guardar la historia cl\xEDnica.";l.status===0?r+=" No se puede conectar con el backend. Verifique que el servidor est\xE9 ejecut\xE1ndose.":l.error?.error?r+=" "+l.error.error:l.error?.details?r+=" Detalles: "+l.error.details:l.message&&(r+=" "+l.message),this.resultMessage.set(r),this.isSubmitting.set(!1)}});else console.log("Creando nueva historia"),console.log("Payload a enviar:",e),this.nutritionService.saveRecord(e).subscribe({next:()=>{this.resultMessage.set("Historia guardada correctamente."),this.isSubmitting.set(!1),this.resetForm()},error:l=>{console.error("Error completo:",l),console.error("Error status:",l.status),console.error("Error response:",l.error);let r="No se pudo guardar la historia.";l.status===0?r+=" No se puede conectar con el backend. Verifique que el servidor est\xE9 ejecut\xE1ndose.":l.error?.error?r+=" "+l.error.error:l.message&&(r+=" "+l.message),this.resultMessage.set(r),this.isSubmitting.set(!1)}})}resetForm(){let t=this.isEditMode();this.nutriForm.reset(),this.frequencySelections={},this.resultMessage.set(null),this.isEditingPatient.set(!0),this.isEditMode.set(!1),this.editingId.set(null),this.editType.set(null),this.pageTitle.set("NutriWeb \xB7 Historia cl\xEDnica nutricional"),t&&this.router.navigate(["/dashboard"])}toggleEditMode(){let t=!this.isEditingPatient();this.isEditingPatient.set(t);let e=this.nutriForm.get("personalData");e&&(t?e.enable():e.disable())}getFrequency(t,e){return this.frequencySelections[this.frequencyKey(t,e)]??this.supportedFrequencies[0]}setFrequency(t,e,l){let r=this.frequencyKey(t,e);this.frequencySelections=M(E({},this.frequencySelections),{[r]:l})}frequencyKey(t,e){return`${t}::${e}`}static \u0275fac=function(e){return new(e||s)(h(R),h(Y),h($),h(T))};static \u0275cmp=F({type:s,selectors:[["app-root"]],decls:56,vars:8,consts:[[1,"page-shell"],[1,"hero"],[1,"eyebrow"],[1,"edit-mode-banner"],[1,"history-form",3,"ngSubmit","formGroup"],[1,"card"],["formGroupName","personalData",1,"grid","grid-3"],["formControlName","nombre","type","text","placeholder","Nombre completo"],["formControlName","edadCronologica","type","text","placeholder","A\xF1os"],["formControlName","sexo","type","text","placeholder","F / M"],["formControlName","lugarResidencia","type","text"],["formControlName","estadoCivil","type","text"],["formControlName","numeroCedula","type","text"],["formControlName","telefono","type","tel"],["formControlName","ocupacion","type","text"],["formControlName","email","type","email"],["formControlName","fechaConsulta","type","date"],[1,"card","info-message"],[1,"actions"],["type","submit",3,"disabled"],["width","20","height","20","viewBox","0 0 20 20","fill","currentColor"],["fill-rule","evenodd","d","M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule","evenodd"],["type","button",1,"ghost",3,"click"],["fill-rule","evenodd","d","M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z","clip-rule","evenodd"],["class","feedback",4,"ngIf"],["d","M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"],[1,"info-content"],["width","24","height","24","viewBox","0 0 20 20","fill","currentColor"],["fill-rule","evenodd","d","M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule","evenodd"],[1,"full"],["formControlName","motivoConsulta","rows","3","placeholder","Describe brevemente el motivo de la consulta"],["formGroupName","antecedentes",1,"grid","grid-3"],["formControlName","apf","type","text"],["formControlName","app","type","text"],["formControlName","apq","type","text"],["formControlName","ago","type","text"],["formControlName","menarquia","type","text"],["formControlName","p","placeholder","P"],["formControlName","g","placeholder","G"],["formControlName","c","placeholder","C"],["formControlName","a","placeholder","A"],["formControlName","alergias","type","text"],["formControlName","diagnostico","rows","3"],["formGroupName","habitos",1,"grid","grid-3"],["formControlName","fuma","type","text"],["formControlName","alcohol","type","text"],["formControlName","cafe","type","text"],["formControlName","hidratacion","type","text"],["formControlName","gaseosas","type","text"],["formControlName","actividadFisica","type","text"],["formControlName","te","type","text"],["formControlName","edulcorantes","type","text"],["formControlName","alimentacion","type","text"],["formGroupName","signos",1,"grid","grid-4"],["formControlName","pa","type","text"],["formControlName","temperatura","type","text"],["formControlName","fc","type","text"],["formControlName","fr","type","text"],["formGroupName","antropometricos",1,"grid","grid-4"],["formControlName","edad","type","text"],["formControlName","edadMetabolica","type","text"],["formControlName","sexo","type","text"],["formControlName","peso","type","text"],["formControlName","masaMuscular","type","text"],["formControlName","gcPorc","type","text"],["formControlName","gc","type","text"],["formControlName","talla","type","text"],["formControlName","gvPorc","type","text"],["formControlName","imc","type","text"],["formControlName","kcalBasales","type","text"],["formControlName","cintura","type","text"],["formControlName","cadera","type","text"],["formControlName","pantorrilla","type","text"],["formControlName","cBrazo","type","text"],["formControlName","cMuslo","type","text"],["formControlName","pesoAjustado","type","text"],["formControlName","factorActividadFisica","type","text"],["formControlName","tiemposComida","type","text"],["formGroupName","valoresBioquimicos",1,"grid","grid-4"],["formControlName","glicemia","type","text"],["formControlName","colesterolTotal","type","text"],["formControlName","trigliceridos","type","text"],["formControlName","hdl","type","text"],["formControlName","ldl","type","text"],["formControlName","tgo","type","text"],["formControlName","tgp","type","text"],["formControlName","urea","type","text"],["formControlName","creatinina","type","text"],["class","frequency-card",4,"ngFor","ngForOf"],["formGroupName","recordatorio24h",1,"grid","grid-2"],["formControlName","desayuno","rows","2"],["formControlName","snack1","rows","2"],["formControlName","almuerzo","rows","2"],["formControlName","snack2","rows","2"],["formControlName","cena","rows","2"],["formControlName","extras","rows","2"],["formControlName","notasExtras","rows","3","placeholder","Observaciones adicionales"],[1,"frequency-card"],[1,"frequency-header"],[1,"table-wrapper"],[4,"ngFor","ngForOf"],[1,"radio-cell"],["type","radio",3,"change","value","checked"],[1,"visually-hidden"],[1,"feedback"]],template:function(e,l){e&1&&(n(0,"div",0)(1,"header",1)(2,"p",2),a(3,"NutriWeb \xB7 Historia cl\xEDnica nutricional"),i(),n(4,"h1"),a(5),i(),C(6,W,5,0,"div",3),n(7,"p"),a(8," Registra los datos cl\xEDnicos, h\xE1bitos y frecuencias alimentarias del paciente para que el equipo nutricional pueda preparar un plan personalizado. "),i()(),n(9,"form",4),v("ngSubmit",function(){return l.submitHistory()}),n(10,"section",5)(11,"h2"),a(12,"Datos personales"),i(),n(13,"div",6)(14,"label"),a(15," Nombre "),o(16,"input",7),i(),n(17,"label"),a(18," Edad cronol\xF3gica "),o(19,"input",8),i(),n(20,"label"),a(21," Sexo "),o(22,"input",9),i(),n(23,"label"),a(24," Lugar de residencia "),o(25,"input",10),i(),n(26,"label"),a(27," Estado civil "),o(28,"input",11),i(),n(29,"label"),a(30," N\xFAmero de c\xE9dula "),o(31,"input",12),i(),n(32,"label"),a(33," Tel\xE9fono "),o(34,"input",13),i(),n(35,"label"),a(36," Ocupaci\xF3n "),o(37,"input",14),i(),n(38,"label"),a(39," Email "),o(40,"input",15),i(),n(41,"label"),a(42," Fecha de consulta "),o(43,"input",16),i()()(),C(44,J,9,0,"section",17),C(45,ie,211,1),n(46,"div",18)(47,"button",19),f(),n(48,"svg",20),o(49,"path",21),i(),a(50," Guardar historia "),i(),b(),n(51,"button",22),v("click",function(){return l.resetForm()}),f(),n(52,"svg",20),o(53,"path",23),i(),a(54),i()(),g(55,ne,2,1,"p",24),i()()),e&2&&(c(5),u(l.pageTitle()),c(),_(l.isEditMode()?6:-1),c(3),d("formGroup",l.nutriForm),c(35),_(l.editType()==="paciente"?44:-1),c(),_(l.editType()!=="paciente"?45:-1),c(2),d("disabled",l.isSubmitting()),c(7),D(" ",l.isEditMode()?"Cancelar":"Restablecer"," "),c(),d("ngIf",l.resultMessage()))},dependencies:[A,k,q,L,I,z,G,V,H,j,B],styles:["[_nghost-%COMP%]{display:block;min-height:100vh;background:linear-gradient(180deg,#f0f9ff,#f8fafc 60%,#fff);color:#0f172a}.page-shell[_ngcontent-%COMP%]{max-width:1400px;margin:0 auto;padding:2rem 1rem 3rem;display:flex;flex-direction:column;gap:1.5rem}.hero[_ngcontent-%COMP%]{text-align:center;padding:2rem 1rem;background:linear-gradient(135deg,#6366f1,#8b5cf6);border-radius:24px;color:#fff;box-shadow:0 20px 40px #6366f14d;margin-bottom:1rem}.hero[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:clamp(1.75rem,5vw,2.5rem);margin:.2rem 0;color:#fff;font-weight:700}.hero[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:.75rem 0 0;color:#fffffff2;max-width:600px;margin-left:auto;margin-right:auto;line-height:1.6}.eyebrow[_ngcontent-%COMP%]{font-size:.8rem;letter-spacing:.12em;text-transform:uppercase;margin-bottom:.5rem;color:#ffffffe6;font-weight:600}.edit-mode-banner[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:.5rem;background:#fbbf2433;border:2px solid rgba(251,191,36,.5);border-radius:12px;padding:.75rem 1.25rem;margin:1rem auto .5rem;max-width:400px;font-weight:600;font-size:.875rem;color:#fef3c7;box-shadow:0 4px 12px #fbbf2433}.edit-mode-banner[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{flex-shrink:0}.info-message[_ngcontent-%COMP%]{background:linear-gradient(135deg,#e0e7ff,#f0f4ff);border:2px solid #6366f1;box-shadow:0 4px 12px #6366f126}.info-content[_ngcontent-%COMP%]{display:flex;gap:1rem;align-items:flex-start}.info-content[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{flex-shrink:0;color:#6366f1;margin-top:.25rem}.info-content[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 .5rem;color:#4f46e5;font-size:1.1rem;font-weight:700}.info-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:#475569;line-height:1.6;font-size:.95rem}.history-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.25rem}.card[_ngcontent-%COMP%]{background:#fff;border-radius:20px;padding:clamp(1.25rem,3vw,2rem);border:1px solid #e2e8f0;box-shadow:0 4px 20px #0f172a0f;transition:all .3s ease}.card[_ngcontent-%COMP%]:hover{box-shadow:0 12px 32px #0f172a1f;transform:translateY(-2px)}.card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-top:0;margin-bottom:1.25rem;font-size:clamp(1.1rem,3vw,1.4rem);color:#0f172a;font-weight:700;border-bottom:3px solid #6366f1;padding-bottom:.75rem;display:inline-block}.section-header-with-action[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;flex-wrap:wrap;gap:1rem}.section-header-with-action[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:0;flex:1}.edit-patient-btn[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:.5rem;padding:.625rem 1.25rem;background:linear-gradient(135deg,#6366f1,#8b5cf6);color:#fff;border:none;border-radius:10px;font-size:.875rem;font-weight:600;cursor:pointer;transition:all .3s ease;box-shadow:0 4px 12px #6366f140}.edit-patient-btn[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 6px 20px #6366f159;background:linear-gradient(135deg,#7c3aed,#a855f7)}.edit-patient-btn[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{flex-shrink:0}.grid[_ngcontent-%COMP%]{display:grid;gap:1rem}.grid-2[_ngcontent-%COMP%]{grid-template-columns:repeat(auto-fit,minmax(min(100%,280px),1fr))}.grid-3[_ngcontent-%COMP%]{grid-template-columns:repeat(auto-fit,minmax(min(100%,200px),1fr))}.grid-4[_ngcontent-%COMP%]{grid-template-columns:repeat(auto-fit,minmax(min(100%,160px),1fr))}label[_ngcontent-%COMP%]{display:flex;flex-direction:column;font-size:.9rem;gap:.5rem;color:#334155;font-weight:600}input[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{border-radius:12px;border:2px solid #e2e8f0;padding:.875rem 1rem;font-size:clamp(.9rem,2vw,1rem);font-family:inherit;background:#fafafa;transition:all .2s ease;width:100%}input[_ngcontent-%COMP%]:focus, textarea[_ngcontent-%COMP%]:focus{outline:none;border-color:#6366f1;background:#fff;box-shadow:0 0 0 4px #6366f11a;transform:translateY(-1px)}textarea[_ngcontent-%COMP%]{resize:vertical;min-height:100px}.frequency-card[_ngcontent-%COMP%]{margin-top:1.5rem;background:#fafbfc;padding:1.25rem;border-radius:12px;border:1px solid #e2e8f0}.frequency-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 .5rem;font-size:1.05rem;color:#1f2937;font-weight:700}.frequency-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:#6b7280;font-size:.9rem}.table-wrapper[_ngcontent-%COMP%]{margin-top:1rem;overflow-x:auto;border-radius:12px;border:1px solid #e2e8f0;background:#fff}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;font-size:clamp(.8rem,2vw,.95rem)}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:clamp(.5rem,2vw,.75rem);text-align:center;border-bottom:1px solid #f3f4f6}th[_ngcontent-%COMP%]{font-weight:600;color:#374151;position:sticky;top:0;background:linear-gradient(180deg,#f9fafb,#f3f4f6);font-size:clamp(.75rem,2vw,.85rem);text-transform:uppercase;letter-spacing:.05em;z-index:10}td[_ngcontent-%COMP%]:first-child, th[_ngcontent-%COMP%]:first-child{text-align:left;padding-left:1rem;font-weight:600;position:sticky;left:0;background:#fff;z-index:5}th[_ngcontent-%COMP%]:first-child{z-index:15;background:linear-gradient(180deg,#f9fafb,#f3f4f6)}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background:#f9fafb}.radio-cell[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:center;align-items:center;min-height:40px}input[type=radio][_ngcontent-%COMP%]{accent-color:#6366f1;cursor:pointer;width:18px;height:18px}.actions[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:1rem;justify-content:center;align-items:center;padding-top:1rem}button[_ngcontent-%COMP%]{border:none;border-radius:999px;padding:1rem 2rem;font-size:clamp(.9rem,2vw,1rem);font-weight:700;cursor:pointer;transition:all .3s ease;min-width:180px;display:inline-flex;align-items:center;justify-content:center;gap:.5rem}button[_ngcontent-%COMP%]:not(.ghost){background:linear-gradient(135deg,#6366f1,#8b5cf6);color:#fff;box-shadow:0 8px 20px #6366f159}button[_ngcontent-%COMP%]:not(.ghost):hover:not(:disabled){box-shadow:0 12px 28px #6366f173;transform:translateY(-2px)}button[_ngcontent-%COMP%]:not(.ghost):disabled{background:linear-gradient(135deg,#c7d2fe,#ddd6fe);box-shadow:none;cursor:wait;opacity:.7}button.ghost[_ngcontent-%COMP%]{background:#fff;border:2px solid #e2e8f0;color:#64748b}button.ghost[_ngcontent-%COMP%]:hover{border-color:#cbd5e1;background:#f8fafc;transform:translateY(-2px)}.feedback[_ngcontent-%COMP%]{margin-top:1rem;padding:1.25rem;background:linear-gradient(135deg,#10b981,#059669);color:#fff;font-weight:600;border-radius:12px;text-align:center;box-shadow:0 4px 12px #10b9814d;animation:_ngcontent-%COMP%_slideDown .3s ease-out}@keyframes _ngcontent-%COMP%_slideDown{0%{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}.visually-hidden[_ngcontent-%COMP%]{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);border:0}@media(max-width:1024px){.page-shell[_ngcontent-%COMP%]{padding:1.5rem .75rem 2rem}.card[_ngcontent-%COMP%]{padding:1.5rem}}@media(max-width:768px){.hero[_ngcontent-%COMP%]{padding:1.5rem 1rem;border-radius:16px}.actions[_ngcontent-%COMP%]{flex-direction:column;width:100%}button[_ngcontent-%COMP%]{width:100%;min-width:unset}.grid-2[_ngcontent-%COMP%], .grid-3[_ngcontent-%COMP%], .grid-4[_ngcontent-%COMP%]{grid-template-columns:1fr}table[_ngcontent-%COMP%], th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{font-size:.75rem}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:.5rem .35rem}td[_ngcontent-%COMP%]:first-child, th[_ngcontent-%COMP%]:first-child{padding-left:.5rem}}@media(max-width:480px){.page-shell[_ngcontent-%COMP%]{padding:1rem .5rem 1.5rem}.hero[_ngcontent-%COMP%]{padding:1.25rem .75rem}.card[_ngcontent-%COMP%]{padding:1.25rem;border-radius:16px}input[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{padding:.75rem .875rem}.frequency-card[_ngcontent-%COMP%]{padding:1rem}}@media(prefers-color-scheme:dark){[_nghost-%COMP%]{background:linear-gradient(180deg,#0f172a,#1e293b 60%,#334155);color:#f1f5f9}.card[_ngcontent-%COMP%]{background:#1e293b;border-color:#334155}input[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{background:#0f172a;border-color:#334155;color:#f1f5f9}.card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#f1f5f9}label[_ngcontent-%COMP%]{color:#cbd5e1}}"]})};export{K as App};
